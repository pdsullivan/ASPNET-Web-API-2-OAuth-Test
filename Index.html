<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>  
<div class="jumbotron">
    <h1>ASP.NET Web API 2 OAuth Test</h1>
</div>
<div class="container body-content">
<div class="row">
    <h3>Auth Request</h3>
    <div class="row">
        <div class="col-md-3">
            <div class="well form-group">
                <label>Base URL</label>
                <input class="form-control" type="text" id="urlTextBase" name="urlTextBase" placeholder="http://localhost:37574"  />
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-md-3">
            <div class="well">
                <h3>Register User <small>"/api/account/register"</small></h3>
                <form id="userData">
                    <div class="form-group">
                        <input class="form-control" type="text" name="email" placeholder="email" />
                        <input class="form-control" type="password" name="password" placeholder="password" />
                        <input class="form-control" type="password" name="confirmPassword" placeholder="confirm Password" />

                        <input class="form-control btn btn-primary" type="submit" id="register" value="Register" />
                    </div>
                </form>
            </div>

        </div>
            
        <div class="col-md-3">
            <div class="well">
                <h3>Login User <small>"/Token"</small></h3>
                <form id="userLoginData">
                    <div class="form-group">
                        <input class="form-control" type="text" name="userName" placeholder="userName"  />
                        <input class="form-control" type="password" name="password" placeholder="password" />
                        <input class="form-control btn btn-primary" type="submit" id="login" value="Login" />
                    </div>
                </form>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="well">
                <h3>Make Call</h3>
                <div class="form-group">
                    <input class="form-control" type="text" id="urlText" name="url" placeholder="/api/values"  />

                    <button class="form-control btn btn-success" id="getData">Get Data</button>
                </div>
            </div>
        </div>
    </div>
   
    <div class="row">
        
        <div class="col-lg-9">
            <div class="well">
                <h3>Access Token</h3>
                <pre id="accessTokenText"></pre>
            </div>
        </div>
    </div>

    <style type="text/css">
        code {
            white-space: pre;
        }
    </style>
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3>Response</h3>

        </div>
        <div class="panel-body">
            
                <pre id="output">
                </pre>
            
        </div>
    </div>

    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script>

        $(function () {

            var getData = function () {
                var url = $('#urlText').val();
                console.log(getBaseUrl() + url);
                $.ajax(getBaseUrl() + url, {
                    type: "GET",
                    headers: getHeaders()
                }).always(showResponse);
                return false;
            };

            var getHeaders = function () {
                if (accessToken) {
                    return { "Authorization": "Bearer " + accessToken };
                }
            };

            var getBaseUrl = function () {
                return $('#urlTextBase').val();
            };

            var showResponse = function (object) {
                $("#output").text(JSON.stringify(object, null, 4));
            };

            var register = function () {
                var url = getBaseUrl() + "/api/account/register";
                var data = $("#userData").serialize();
                $.post(url, data).always(showResponse);
                return false;
            };

            var saveAccessToken = function (data) {
                accessToken = data.access_token;
                $("#accessTokenText").text(JSON.stringify(data.access_token, null, 4));
            };

            var login = function () {
                var url = getBaseUrl() + "/Token";
                var data = $("#userLoginData").serialize();
                data = data + "&grant_type=password";
                $.post(url, data)
                 .success(saveAccessToken)
                 .always(showResponse);
                return false;
            };

            var accessToken = "";

            $("#login").click(login);
            $("#register").click(register);
            $("#getData").click(getData);

        });

    </script>
</div>

</div> <!--container body-content-->
<hr />
<footer>
    <p>&copy; 2014 - Patrick Sullivan</p>
</footer>




    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>



</body>
</html>
